<!doctype html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>Players Test</title>
  </head>
  <style media="screen">
    #cards button, #bets button { margin: 5px; }
  </style>
  <body>
    <input id="name" type="text" name="name" value=""/>
    <button onclick="join()">Join</button>
    <div id="cards"></div>
    <div id="bets"></div>
    <ul id="players"></ul>

    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var socket = io('http://localhost:3000');
      var deck = [];

      function join() {
        var name = $('#name').val();
        socket.emit('join', name);
      }

      function select(cardId) {
        console.log("Picked card: " + cardId);
        $("#cards button").prop("disabled", true);

        socket.emit('pick-card', cardId);
      }

      function bet(cardId) {
        console.log("Picked bet: " + cardId);
        $("#bets button").prop("disabled", true);

        socket.emit('pick-bet', cardId);
      }

      socket.on('update-all', function(players) {
        console.log('update-all', JSON.stringify(players));

        $("#players").empty();
        for (p of players) {
          var i = $('<li>' + p.name + ': ' + p.score + '</li>');
          $("#players").append(i);
        }
      });

      socket.on('update', function(player) {
        console.log('update', JSON.stringify(player));
        deck = player.deck;

        $("#bets").empty();
        $("#cards").empty();
        for (card of deck) {
          var b = $('<button disabled="disabled" onclick="select(' + card.id + ')">' + card.id + '</button>');
          $("#cards").append(b);
        }
      });

      socket.on('allow-pick-card', function() {
        console.log('allow-pick-card');
        $("#cards button").prop("disabled", false);
      });

      socket.on('allow-pick-bet', function(bets) {
        console.log('allow-pick-bet');

        $("#bets").empty();
        for (card of bets) {
          var b = $('<button onclick="bet(' + card.id + ')">' + card.id + '</button>');
          $("#bets").append(b);
        }
      });
    </script>
  </body>
</html>
